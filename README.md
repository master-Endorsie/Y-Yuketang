# Y-Yuketang é•¿æ±Ÿé›¨è¯¾å ‚è‡ªåŠ¨åŒ–å·¥å…·

## ğŸš€ é¡¹ç›®ç®€ä»‹
æœ¬é¡¹ç›®æ”¯æŒè‡ªåŠ¨ç­¾åˆ°ã€AIè‡ªåŠ¨ç­”é¢˜ï¼ˆç”»é¥¼ï¼‰ã€PPTä¸‹è½½åŠè¯¾å ‚è¿›åº¦ç›‘æ§ã€‚åŸºäº Python å¼‚æ­¥æ¡†æ¶å®ç°å¤šçº¿ç¨‹ç›‘å¬ï¼Œé€‚é…ä¼ä¸šå¾®ä¿¡æ¨é€ã€‚

---

## ğŸ“¦ å®‰è£…ä¸ä¾èµ–
### ä¾èµ–å®‰è£…
```bash
pip install -r requirements.txt
```

#### Linux ç³»ç»Ÿä¾èµ–
```bash
sudo apt-get install libzbar0 libzbar-dev  # å®‰è£… pyzbar ä¾èµ–
```

#### Windows ç³»ç»Ÿ
ç¡®ä¿å·²å®‰è£… [Microsoft Visual C++ Redistributable](https://aka.ms/vs/17/release/vc_redist.x64.exe)ã€‚

---

## ğŸšï¸ è¿è¡Œæ–¹å¼
```bash
python main.py
```

---

## ğŸ“„ é…ç½®æ–‡ä»¶è¯´æ˜
### é…ç½®æ–‡ä»¶ç»“æ„ (`config.json`)
```json
{
  "yuketang": {
    "domain": "changjiang.yuketang.cn",          // é›¨è¯¾å ‚åŸŸåï¼ˆé»˜è®¤ï¼‰
    "classroomCodeList": ["JZOJ5C", "G84UAB"],  // ç­çº§é‚€è¯·ç /è¯¾å ‚æš—å·åˆ—è¡¨
    "classroomWhiteList": [],             // ç™½åå•è¯¾ç¨‹ï¼ˆå®Œå…¨åŒ¹é…ï¼‰
    "clashroomBlackList": ["è¯¾ç¨‹å1"],    // é»‘åå•è¯¾ç¨‹
    "clashroomStartTimeDict": {
      "è¯¾ç¨‹å": {"1": "08:30", "3": "14:00"}  // è¯¾ç¨‹ç­¾åˆ°æ—¶é—´é™åˆ¶ï¼ˆå‘¨1-7å¯¹åº”å‘¨ä¸€åˆ°å‘¨æ—¥ï¼‰
    },
    "an": false,          // è‡ªåŠ¨ç­”é¢˜å¼€å…³
    "ppt": false,         // è‡ªåŠ¨ä¸‹è½½PPTå¼€å…³
    "si": false,          // PPTè¿›åº¦æ¨é€å¼€å…³
    "timeout": 30        // APIè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  },
  "users": [
    {"name": "user1", "openId": "OPENID1"},
    {"name": "user2", "openId": "OPENID2"}
  ]
}
```

### é…ç½®é¡¹è¯¦ç»†è¯´æ˜
#### **`Y-Yuketang` é…ç½®**
| å‚æ•°å                  | ç±»å‹    | è¯´æ˜                                                                 |
|-------------------------|---------|--------------------------------------------------------------------|
| `domain`                | String  | é•¿æ±Ÿé›¨è¯¾å ‚åŸŸå `changjiang.yuketang.cn` |
| `classroomCodeList`     | Array   | éœ€è¦åŠ å…¥çš„ç­çº§é‚€è¯·ç /è¯¾å ‚æš—å·åˆ—è¡¨                                           |
| `clashroomStartTimeDict`| Object  | è¯¾ç¨‹ç­¾åˆ°æ—¶é—´é™åˆ¶ï¼ˆç¤ºä¾‹ï¼š`"è¯¾ç¨‹å": {"1": "08:30"}`ï¼‰                       |
| `an`                    | Boolean | å¯ç”¨è‡ªåŠ¨ç­”é¢˜ï¼ˆéœ€å¤šäººå…±äº«ç­”æ¡ˆåº“ï¼‰                                        |
| `ppt`                   | Boolean | è‡ªåŠ¨ä¸‹è½½PPTå¹¶ç”ŸæˆPDF                                                    |
| `si`                    | Boolean | å®æ—¶æ¨é€PPTå½“å‰é¡µç ï¼ˆéœ€è°¨æ…ä½¿ç”¨ï¼Œé¿å…æ¶ˆæ¯è½°ç‚¸ï¼‰                          |

#### **`users` é…ç½®**
æ¯ä¸ªç”¨æˆ·éœ€åŒ…å«ï¼š
```json
{
  "name": "ç”¨æˆ·æ ‡è¯†ï¼ˆå¦‚å­¦å·ï¼‰",
  "openId": "é›¨è¯¾å ‚OpenIDï¼ˆæ‰«ç ç™»å½•åè‡ªåŠ¨ç”Ÿæˆï¼‰"
}
```

---

## ğŸ“Œ åŠŸèƒ½ç‰¹æ€§
### 1. è‡ªåŠ¨ç­¾åˆ°
- **è§¦å‘é¢‘ç‡**ï¼šæ¯ 30 ç§’æ£€æŸ¥æ–°è¯¾ç¨‹ã€‚
- **æ”¯æŒåœºæ™¯**ï¼šé€šè¿‡é‚€è¯·ç åŠ å…¥è¯¾ç¨‹å¹¶è‡ªåŠ¨ç­¾åˆ°ã€‚

### 2. è‡ªåŠ¨ç­”é¢˜
- **é¢˜å‹æ”¯æŒ**ï¼šå•é€‰ã€å¤šé€‰ã€å¡«ç©ºï¼ˆä¾èµ–å…±äº«ç­”æ¡ˆåº“ï¼‰ã€‚
- **é™åˆ¶**ï¼šéœ€å¤šäººåŒæ—¶è¿è¡Œä»¥å…±äº«ç­”æ¡ˆã€‚

### 3. PPT ä¸‹è½½ä¸ç›‘æ§
- **å­˜å‚¨è·¯å¾„**ï¼š`./{lessonId}/`ï¼ˆå¦‚ `./2023ç§‹-æœºå™¨å­¦ä¹ -0/`ï¼‰ã€‚
- **æ–‡ä»¶æ ¼å¼**ï¼šPPTå›¾ç‰‡è½¬ä¸º PDF æ–‡ä»¶ï¼Œå‘½åæ ¼å¼ `è¯¾ç¨‹å-æ ‡é¢˜.pdf`ã€‚

---

## ğŸ› ï¸ æ¨é€é…ç½®æŒ‡å—
### ä¼ä¸šå¾®ä¿¡ (`wx`)
1. æ³¨å†Œä¼ä¸šå¾®ä¿¡åº”ç”¨ï¼Œè·å– `agentId`ã€`secret`ã€`companyId`ã€‚
2. åœ¨ `config.json` ä¸­å¯ç”¨ `yuketang.wx = true`ï¼Œå¹¶å¡«å†™ `send.wx` é…ç½®ï¼š
   ```json
   "send": {
     "wx": {
       "touser": "@all",
       "agentId": "ä½ çš„AgentID",
       "secret": "ä½ çš„Secret",
       "companyId": "ä¼ä¸šID"
     }
   }
   ```

---

## ğŸ“Š å…³é”®é…ç½®å‚æ•°
| æ¨é€æ–¹å¼ | æ¶ˆæ¯é™åˆ¶ (`msgLimit`) | æ–‡ä»¶é™åˆ¶ (`dataLimit`) |
|----------|----------------------|----------------------|
| ä¼ä¸šå¾®ä¿¡ (`wx`) | 500 å­—ç¬¦              | 20MB (20971520)       |

---

## ğŸš¨ å¸¸è§é—®é¢˜ä¸æ’æŸ¥
### 1. **è‡ªåŠ¨ç­”é¢˜å¤±è´¥**
- **å¯èƒ½åŸå› **ï¼š
  - `an` æœªè®¾ä¸º `true`ã€‚
  - å…±äº«ç­”æ¡ˆåº“ (`shared_answers`) ä¸ºç©ºã€‚
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ç¡®ä¿ `an: true` å¹¶å¤šäººåŒæ—¶è¿è¡Œç¨‹åºå¹¶æœ‰äººæäº¤ç­”æ¡ˆ

### 2. **PPT ä¸‹è½½å¤±è´¥**
- **æ’æŸ¥æ­¥éª¤**ï¼š
  1. æ£€æŸ¥ `util.threads` çº¿ç¨‹æ•°æ˜¯å¦è¿‡ä½ã€‚
  2. ç¡®è®¤ `util.timeout` æ˜¯å¦è¶³å¤Ÿï¼ˆé»˜è®¤ 30 ç§’ï¼‰ã€‚

---

## âš ï¸ é¡¹ç›®å£°æ˜
1. **å½“å‰çŠ¶æ€**ï¼š
   - **å·²å®ç°**ï¼šè‡ªåŠ¨ç­¾åˆ°ã€PPT ä¸‹è½½ã€åŸºç¡€ç­”é¢˜é€»è¾‘ã€‚
   - **å¾…å¼€å‘**ï¼šAI è‡ªåŠ¨ç­”é¢˜ï¼ˆæ¡†æ¶æ­å»ºä¸­ï¼‰ã€ç¨³å®šæ€§ä¼˜åŒ–ã€‚

2. **å…è´£å£°æ˜**ï¼š
   - æœ¬é¡¹ç›®ä¸ºå­¦ä¹ ä½œå“ï¼Œå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚
   - å»ºè®®ä¼˜å…ˆå°è¯•åŸé¡¹ç›®ï¼š[yuketang](https://github.com/Mathew-Carl/yuketang),[thuhollow2/Hetangyuketang](https://github.com/thuhollow2/Hetangyuketang)ã€‚

---

## ğŸ“– å¿«é€Ÿå¼€å§‹
### æ­¥éª¤ 1ï¼šé…ç½® `config.json`

### æ­¥éª¤ 2ï¼šè¿è¡Œç¨‹åº
```bash
python main.py
```

### æ­¥éª¤ 3ï¼šæ‰«ç ç™»å½•
1. ç¨‹åºç”Ÿæˆ `userXqrcode.jpg`ï¼Œæ‰«ç åè·å– Cookieã€‚
2. æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹ï¼š
   ```
   MSG: Cookieæœ‰æ•ˆï¼Œå‰©ä½™æ—¶é—´ï¼š1å¤© 2å°æ—¶ã€‚
   ```

---

## ğŸ“Œ æŠ€æœ¯æ¶æ„
```
1. æ ¸å¿ƒæ¶æ„è®¾è®¡
1.1 å¼‚æ­¥äº‹ä»¶é©±åŠ¨æ¡†æ¶
æŠ€æœ¯æ ˆï¼šåŸºäº Python çš„ asyncio å’Œ websockets åº“å®ç°å¼‚æ­¥äº‹ä»¶é©±åŠ¨ã€‚
åŠŸèƒ½ï¼š
æ”¯æŒå¤šç”¨æˆ·å¹¶å‘å¤„ç†ï¼ˆé€šè¿‡ UserManager ç®¡ç†ç”¨æˆ·ä»»åŠ¡ï¼‰ã€‚
å®æ—¶ç›‘å¬è¯¾ç¨‹çŠ¶æ€å˜åŒ–ï¼ˆå¦‚ç­¾åˆ°ã€PPTæ›´æ–°ã€ç­”é¢˜äº‹ä»¶ï¼‰ã€‚
é€šè¿‡ WebSocket ä¸é›¨è¯¾å ‚æœåŠ¡å™¨ä¿æŒé•¿è¿æ¥ã€‚
1.2 æ¨¡å—åŒ–è®¾è®¡
å…³é”®æ¨¡å—ï¼š
main.pyï¼šç¨‹åºå…¥å£ï¼Œå¯åŠ¨å¼‚æ­¥äº‹ä»¶å¾ªç¯ã€‚
user_manager.pyï¼šç®¡ç†ç”¨æˆ·å®ä¾‹ï¼Œä¸ºæ¯ä¸ªç”¨æˆ·å¯åŠ¨ç‹¬ç«‹çš„å¼‚æ­¥ä»»åŠ¡ã€‚
yuketang.pyï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ¨¡å—ï¼Œå¤„ç†ï¼š
ç”¨æˆ·ç™»å½•ã€Cookie ç®¡ç†ã€‚
è¯¾ç¨‹ç­¾åˆ°ã€PPT ä¸‹è½½ã€ç­”é¢˜é€»è¾‘ã€‚
WebSocket ç›‘å¬è¯¾ç¨‹äº‹ä»¶ã€‚
send.pyï¼šæ¶ˆæ¯æ¨é€æ¨¡å—ï¼Œæ”¯æŒä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€é£ä¹¦ç­‰å¹³å°ã€‚
util.pyï¼šå·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ“ä½œã€æ—¶é—´å¤„ç†ã€äºŒç»´ç ç”Ÿæˆç­‰ã€‚
```

---

## ğŸ“¢ å£°æ˜ä¸è”ç³»æ–¹å¼
### é¡¹ç›®çŠ¶æ€
> **æ³¨æ„**ï¼šæœ¬é¡¹ç›®ä»å¤„äºå¼€å‘é˜¶æ®µï¼Œå¯èƒ½å­˜åœ¨æœªä¿®å¤çš„ Bugã€‚å»ºè®®ä¼˜å…ˆä½¿ç”¨åŸé¡¹ç›®ä»£ç ã€‚

### è”ç³»æˆ‘ä»¬
- **GitHub Issues**ï¼š[æäº¤é—®é¢˜æˆ–å»ºè®®](https://github.com/master-Endorsie/Y-Yuketang/issues)
- **ä½œè€…é‚®ç®±**ï¼šshiina-mayuri@foxmail.com

---

## ğŸ“ é™„å½•
### 1. ä¾èµ–åº“åˆ—è¡¨
```python
requests        # HTTPè¯·æ±‚
websockets      # WebSocketé€šä¿¡
aiofiles        # å¼‚æ­¥æ–‡ä»¶æ“ä½œ
pyzbar          # äºŒç»´ç è¯†åˆ«
Pillow          # å›¾åƒå¤„ç†
python-dateutil # æ—¶é—´è½¬æ¢
openai          # OpenAI API
```

### 2. æ¨é€ç¤ºä¾‹
```plaintext
è¯¾ç¨‹: å¤§å­¦å¤–è¯­
æ ‡é¢˜: å¤§å­¦è‹±è¯­ å››çº§è€ƒè¯•ï¼ˆ2ï¼‰
æ•™å¸ˆ: å°ç¾
å¼€å§‹æ—¶é—´: 2025å¹´03æœˆ11æ—¥09æ—¶41åˆ†55ç§’
æ¶ˆæ¯: ç­¾åˆ°æˆåŠŸ
```
